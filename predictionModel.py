import tensorflow as tf
import tensorflow.keras as keras
import matplotlib.pyplot as plt
import numpy as np
import os
import csv

class Model:
    def __init__(self, model_filepath):
        self.model = keras.models.load_model(model_filepath)
        self.csvdata = []
        fields = []
        # reading csv file
        with open('editedfastfood.csv', 'r') as csvfile:
            # creating a csv reader object
            csvreader = csv.reader(csvfile)
        
            # extracting field names through first row
            fields = next(csvreader)
        
            # extracting each data row one by one
            for row in csvreader:
                item = {}
                for val, field in zip(row, fields):
                    item[field] = val
                self.csvdata.append(item)

        print(len(self.csvdata))

        # self.classes = ['Arbys 2 piece Prime-Cut Chicken Tenders', 'Arbys 3 piece Prime-Cut Chicken Tenders', 'Arbys 5 piece Prime-Cut Chicken Tenders', "Arbys Arby's Melt", 'Arbys Arby-Q Sandwich', "Arbys Beef 'n Cheddar Classic", "Arbys Beef 'n Cheddar Mid", 'Arbys Bourbon BBQ Brisket Sandwich', 'Arbys Bourbon BBQ Chicken Sandwich', 'Arbys Bourbon BBQ Steak Sandwich', 'Arbys Buffalo Chicken Slider', 'Arbys Buttermilk Buffalo Chicken Sandwich', 'Arbys Buttermilk Chicken Bacon & Swiss', 'Arbys Buttermilk Chicken Cordon Bleu Sandwich', 'Arbys Buttermilk Crispy Chicken Sandwich', "Arbys Chicken Tender 'n Cheese Slider", 'Arbys Chopped Side Salad', 'Arbys Classic Roast Beef', "Arbys Corned Beef 'n Cheese Slider", 'Arbys Crispy Chicken Farmhouse Salad', 'Arbys Double Roast Beef', 'Arbys Fire-Roasted Philly Steak', 'Arbys Grand Turkey Club', 'Arbys Greek Gyro', 'Arbys Greek Gyro Salad', "Arbys Half Pound Beef 'n Cheddar Sandwich", 'Arbys Half Pound French Dip & Swiss', 'Arbys Half Pound Roast Beef Sandwich', 'Arbys Ham & Swiss Melt', "Arbys Ham 'n Cheese Slider", "Arbys Jalapeno Roast Beef 'n Cheese Slider", 'Arbys Loaded Italian Sandwich', 'Arbys Pecan Chicken Salad Flatbread', 'Arbys Pecan Chicken Salad Sandwich', 'Arbys Pizza Slider', 'Arbys Reuben Sandwich', "Arbys Roast Beef 'n Cheese Slider", 'Arbys Roast Beef Gyro', 'Arbys Roast Turkey & Swiss Sandwich', 'Arbys Roast Turkey & Swiss Wrap', 'Arbys Roast Turkey Farmhouse Salad', 'Arbys Roast Turkey, Ranch & Bacon Sandwich', 'Arbys Roast Turkey, Ranch & Bacon Wrap', 'Arbys Smokehouse Beef Short Rib Sandwich', 'Arbys Smokehouse Brisket', 'Arbys Super Greek Salad', 'Arbys Super Roast Beef', 'Arbys Three Cheese Steak Sandwich', 'Arbys Triple Decker Sandwich', "Arbys Turkey 'n Cheese Slider", 'Arbys Turkey Avocado Club', 'Arbys Turkey Gyro', 'Arbys Ultimate BLT', 'Burger King 20 Piece Chicken Nuggets', 'Burger King 4 Piece Chicken Nuggets', 'Burger King 4 Piece Spicy Chicken Nuggets', 'Burger King 6 Piece Chicken Nuggets', 'Burger King American Brewhouse King', 'Burger King Bacon & Cheese Whopper', 'Burger King Bacon & Swiss Sourdough King', 'Burger King Bacon Cheddar Ranch Crispy Chicken Sandwich', 'Burger King Bacon Cheeseburger', 'Burger King Bacon Cheeseburger Deluxe', 'Burger King Bacon King', 'Burger King Bacon King Jr', 'Burger King BBQ Bacon Crispy Chicken Sandwich', 'Burger King BBQ Bacon King', 'Burger King Big Fish Sandwich', 'Burger King BK VEGGIE Burger', 'Burger King Cheeseburger', 'Burger King Chicken Burger', 'Burger King Chicken Cordon Bleu Sandwich', 'Burger King Chicken Fries', 'Burger King Chicken Nuggets (10pc)', 'Burger King Chicken Parmesan Sandwich', 'Burger King Crispy Buffalo Chicken Melt', 'Burger King Crispy Chicken Jr', 'Burger King Crispy Chicken Sandwich', 'Burger King Double Bacon Cheeseburger', 'Burger King Double Cheeseburger', 'Burger King Double Hamburger', 'Burger King Double Quarter Pound King', 'Burger King Extra Long Cheeseburger', 'Burger King Farmhouse King', 'Burger King Grilled Chicken Sandwich', 'Burger King Grilled Chili Cheese Dog', 'Burger King Grilled Hot Dog', 'Burger King Hamburger', 'Burger King Homestyle Cheeseburger', 'Burger King Jalapeno Chicken Fries', 'Burger King Jalapeno King Sandwich', 'Burger King Mushroom & Swiss King', 'Burger King Original Chicken Sandwich', 'Burger King Pretzel Chicken Fries', 'Burger King Rodeo Burger', 'Burger King Rodeo Crispy Chicken Sandwich', 'Burger King Rodeo King', 'Burger King Side Caesar Salad with dressing', 'Burger King Side Garden Salad and Avocado Ranch Dressing', 'Burger King Sourdough Chicken Club', 'Burger King Sourdough King Double', 'Burger King Sourdough King Single', 'Burger King Spicy Chicken Nuggets', 'Burger King Spicy Crispy Chicken Jr', 'Burger King Spicy Crispy Chicken Sandwich', 'Burger King Spicy Crispy Jalapeno Chicken Sandwich', 'Burger King Steakhouse King', 'Chick Fil-A 1 Piece Chick-n-Strips', 'Chick Fil-A 12 piece Chicken Nuggets', 'Chick Fil-A 12 Piece Grilled Chicken Nuggets', 'Chick Fil-A 2 Piece Chick-n-Strips', 'Chick Fil-A 3 Piece Chick-n-Strips', 'Chick Fil-A 30 piece Chicken Nuggets', 'Chick Fil-A 4 piece Chick-n-Strips', 'Chick Fil-A 4 piece Chicken Nuggets', 'Chick Fil-A 4 Piece Grilled Chicken Nuggets', 'Chick Fil-A 6 piece Chicken Nuggets', 'Chick Fil-A 6 Piece Grilled Chicken Nuggets', 'Chick Fil-A 8 piece Chicken Nuggets', 'Chick Fil-A 8 piece Grilled Chicken Nuggets', 'Chick Fil-A Chargrilled Chicken Club Sandwich', 'Chick Fil-A Chargrilled Chicken Cool Wrap', 'Chick Fil-A Chargrilled Chicken Sandwich', 'Chick Fil-A Chick-n-Slider', 'Chick Fil-A Chicken Deluxe', 'Chick Fil-A Chicken Enchiladas Meal Kit', 'Chick Fil-A Chicken Parmesan Meal Kit', 'Chick Fil-A Chicken Salad Sandwich', 'Chick Fil-A Chicken Sandwich', 'Chick Fil-A Regular Grilled Chicken Sub Sandwich', 'Chick Fil-A Smokehouse BBQ Bacon Sandwich', 'Chick Fil-A Spicy Chicken Sandwich', 'Chick Fil-A Spicy Deluxe', 'Chick Fil-A Spicy Grilled Chicken Sub Sandwich', 'Mcdonalds 10 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 10 Piece Chicken McNuggets', "Mcdonalds 10 piece Sweet N' Spicy Honey BBQ Glazed Tenders", 'Mcdonalds 12 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 20 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 20 Piece Chicken McNuggets', 'Mcdonalds 3 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 4 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 4 Piece Chicken McNuggets', "Mcdonalds 4 piece Sweet N' Spicy Honey BBQ Glazed Tenders", 'Mcdonalds 40 piece Chicken McNuggets', 'Mcdonalds 6 piece Buttermilk Crispy Chicken Tenders', 'Mcdonalds 6 Piece Chicken McNuggets', "Mcdonalds 6 piece Sweet N' Spicy Honey BBQ Glazed Tenders", 'Mcdonalds Artisan Grilled Chicken Sandwich', 'Mcdonalds Big Mac', 'Mcdonalds Cheeseburger', 'Mcdonalds Classic Chicken Sandwich', 'Mcdonalds Crispy Bacon Smokehouse Chicken Sandwich', 'Mcdonalds Crispy Garlic White Cheddar Chicken Sandwich', 'Mcdonalds Crispy Maple Bacon Dijon Chicken Sandwich', 'Mcdonalds Crispy Pico Guacamole Chicken Sandwich', 'Mcdonalds Crispy Signature Sriracha Chicken Sandwich', 'Mcdonalds Crispy Sweet BBQ Bacon Chicken Sandwich', 'Mcdonalds Double Bacon Smokehouse Burger', 'Mcdonalds Double Cheeseburger', 'Mcdonalds Double Quarter Pounder with Cheese', 'Mcdonalds Filet-O-Fish', 'Mcdonalds Garlic White Cheddar Burger', 'Mcdonalds Grilled Bacon Smokehouse Chicken Sandwich', 'Mcdonalds Grilled Garlic White Cheddar Chicken Sandwich', 'Mcdonalds Grilled Maple Bacon Dijon Chicken Sandwich', 'Mcdonalds Grilled Pico Guacamole Chicken Sandwich', 'Mcdonalds Grilled Signature Sriracha Chicken Sandwich', 'Mcdonalds Grilled Sweet BBQ Bacon Chicken Sandwich', 'Mcdonalds Hamburger', 'Mcdonalds Lobster Roll', 'Mcdonalds McChicken', 'Mcdonalds McDouble', 'Mcdonalds McRib', 'Mcdonalds Premium Buttermilk Crispy Chicken Deluxe Sandwich', 'Mcdonalds Premium Crispy Chicken Deluxe Sandwich', 'Mcdonalds Quarter Pounder with Cheese', 'Mcdonalds Signature Sriracha Burger', 'Mcdonalds Single Bacon Smokehouse Burger', 'Subway Autumn Carved Turkey Salad', 'Subway B.L.T. Salad', 'Subway Big Hot Pastrami Melt Salad', 'Subway Big Philly Cheesesteak Salad', 'Subway Black Forest Ham Salad', 'Subway Buffalo Chicken Salad (with Ranch dressing)', 'Subway Carved Turkey Salad', 'Subway Cheese & Veggies Pizza', 'Subway Cheese Pizza', 'Subway Chicken & Bacon Ranch Melt Salad (includes Ranch dressing)', 'Subway Chipotle Southwest Steak & Cheese Wrap', 'Subway Cold Cut Combo Salad', 'Subway Double Chicken Salad', 'Subway Footlong B.L.T', 'Subway Footlong BBQ Rib Sandwich', 'Subway Footlong Big Hot Pastrami', 'Subway Footlong Big Philly Cheesesteak', 'Subway Footlong Black Forest Ham', 'Subway Footlong Carved Turkey', 'Subway Footlong Chicken & Bacon Ranch Melt', 'Subway Footlong Chicken Pizziola Melt', 'Subway Footlong Cold Cut Combo', 'Subway Footlong Corned Beef Reuben', 'Subway Footlong Italian B.M.T', 'Subway Footlong Italian Hero', 'Subway Footlong Meatball Marinara', 'Subway Footlong Oven Roasted Chicken', 'Subway Footlong Roast Beef', 'Subway Footlong Rotisserie Style Chicken', 'Subway Footlong Spicy Italian', 'Subway Footlong Steak and Cheese', 'Subway Footlong Subway Club', 'Subway Footlong Subway Melt (includes cheese)', 'Subway Footlong Subway Seafood Sensation', 'Subway Footlong Sweet Onion Chicken Teriyaki', 'Subway Footlong Tuna', 'Subway Footlong Turkey & Bacon Avocado', 'Subway Footlong Turkey Breast', 'Subway Footlong Turkey Breast & Ham', 'Subway Footlong Turkey Italiano Melt (with Provolone)', 'Subway Footlong Veggie Delite', 'Subway Footlong Veggie Patty', 'Subway Italian B.M.T. Salad', 'Subway Italian Hero Salad', 'Subway Kids Mini Sub Black Forest Ham', 'Subway Kids Mini Sub Roast Beef', 'Subway Kids Mini Sub Turkey Breast', 'Subway Kids Mini Sub Veggie Delite', 'Subway Meatball Marinara Salad', 'Subway Oven Roasted Chicken Salad', 'Subway Pepperoni Pizza', 'Subway Roast Beef Salad', 'Subway Rotisserie-Style Chicken Caesar Wrap', 'Subway Sausage Pizza', 'Subway Spicy Italian Salad', 'Subway Steak & Cheese Salad', 'Subway Subway Club Salad', 'Subway Subway Melt Salad', 'Subway Sweet Onion Chicken Teriyaki Salad', 'Subway Tuna Salad', 'Subway Turkey Breast & Ham Salad', 'Subway Turkey Breast Salad', 'Subway Turkey, Bacon & Guacamole Wrap', 'Subway Veggie Delite Salad', 'Taco Bell 7-Layer Burrito', 'Taco Bell Bean Burrito', 'Taco Bell Beef Crunchy Cheesy Core Burrito', 'Taco Bell Beef Quesalupa', 'Taco Bell Beef Quesarito', 'Taco Bell Beef Spicy Cheesy Core Burrito', 'Taco Bell Beefy 5-Layer Burrito', 'Taco Bell Beefy Cheddar Crunchwrap Slider', 'Taco Bell Beefy Fritos Burrito', 'Taco Bell Beefy Mini Quesadilla', 'Taco Bell Beefy Nacho Griller', 'Taco Bell Black Bean Burrito', 'Taco Bell BLT Crunchwrap Slider', 'Taco Bell Burrito Supreme - Chicken', 'Taco Bell Burrito Supreme - Steak', 'Taco Bell Burrito Supreme “ Beef', 'Taco Bell Cantina Power Bowl - Chicken', 'Taco Bell Cantina Power Bowl - Steak', 'Taco Bell Cantina Power Bowl - Veggie', 'Taco Bell Cantina Power Burrito - Chicken', 'Taco Bell Cantina Power Burrito - Steak', 'Taco Bell Cantina Power Burrito - Veggie', 'Taco Bell Chalupa Supreme - Chicken', 'Taco Bell Chalupa Supreme - Steak', 'Taco Bell Chalupa Supreme“Beef', 'Taco Bell Cheese Quesadilla', 'Taco Bell Cheese Roll-Up', 'Taco Bell Cheesy Bean and Rice Burrito', 'Taco Bell Cheesy Gordita Crunch', 'Taco Bell Chicken Crunchy Cheesy Core Burrito', 'Taco Bell Chicken Quesadilla', 'Taco Bell Chicken Quesalupa', 'Taco Bell Chicken Quesarito', 'Taco Bell Chicken Soft Taco', 'Taco Bell Chicken Spicy Cheesy Core Burrito', 'Taco Bell Chickstar', 'Taco Bell Chili Cheese Burrito', 'Taco Bell Chipotle Crispy Chicken Griller', 'Taco Bell Cool Ranch Doritos Double Decker Taco', 'Taco Bell Cool Ranch Doritos Locos Taco', 'Taco Bell Cool Ranch Doritos Locos Taco Supreme', 'Taco Bell Cool Ranch Habanero Double Stacked Taco', 'Taco Bell Crispy Chicken Quesadilla', 'Taco Bell Crunchwrap Supreme', 'Taco Bell Crunchy Taco', 'Taco Bell Crunchy Taco Supreme', 'Taco Bell Doritos Cheesy Gordita Crunch - Cool Ranch', 'Taco Bell Doritos Cheesy Gordita Crunch - Fiery', 'Taco Bell Doritos Cheesy Gordita Crunch - Nacho Cheese', 'Taco Bell Double Chalupa', 'Taco Bell Double Cheesy Gordita Crunch', 'Taco Bell Double Decker Taco', 'Taco Bell DOUBLE DECKER Taco Supreme', 'Taco Bell Double Tostada', 'Taco Bell Fiery Doritos Double Decker Taco', 'Taco Bell Fiery Doritos Locos Taco', 'Taco Bell Fiery Doritos Locos Taco Supreme', 'Taco Bell Fiesta Taco Salad-Beef', 'Taco Bell Fiesta Taco Salad-Chicken', 'Taco Bell Fiesta Taco Salad-Steak', 'Taco Bell Fresco Bean Burrito', 'Taco Bell Fresco Burrito Supreme “ Chicken', 'Taco Bell Fresco Burrito Supreme “ Steak', 'Taco Bell Fresco Chicken Soft Taco', 'Taco Bell Fresco Crunchy Taco', 'Taco Bell Fresco Grilled Steak Soft Taco', 'Taco Bell Fresco Soft Taco', 'Taco Bell Gordita Supreme - Chicken', 'Taco Bell Gordita Supreme - Steak', 'Taco Bell Gordita Supreme “ Beef', 'Taco Bell Grilled Steak Soft Taco', 'Taco Bell Loaded Potato Griller', 'Taco Bell Loaded Taco Burrito', 'Taco Bell Mexican Pizza', 'Taco Bell MexiMelt', 'Taco Bell Mild Naked Chicken Chalupa', 'Taco Bell Nacho Cheese Doritos Double Decker Taco', 'Taco Bell Nacho Cheese Doritos Locos Tacos', 'Taco Bell Nacho Cheese Doritos Locos Tacos Supreme', 'Taco Bell Nacho Crunch Double Stacked Taco', 'Taco Bell Nacho Fries Bellgrande', 'Taco Bell Nachos BellGrande', 'Taco Bell Nachos Supreme', 'Taco Bell Original Triple Double Crunchwrap', 'Taco Bell Shredded Chicken Burrito', 'Taco Bell Shredded Chicken Mini Quesadilla', 'Taco Bell Smothered Burrito - Beef', 'Taco Bell Smothered Burrito - Shredded Chicken', 'Taco Bell Smothered Burrito - Steak', 'Taco Bell Soft Taco Supreme “ Beef', 'Taco Bell Soft Taco-Beef', 'Taco Bell Spicy Chicken Crunchwrap Slider', 'Taco Bell Spicy Double Chalupa', 'Taco Bell Spicy Potato Soft Taco', 'Taco Bell Spicy Sweet Double Stacked Taco', 'Taco Bell Spicy Tostada', 'Taco Bell Spicy Triple Double Crunchwrap', 'Taco Bell Stacker', 'Taco Bell Steak Crunchy Cheesy Core Burrito', 'Taco Bell Steak Quesadilla', 'Taco Bell Steak Quesalupa', 'Taco Bell Steak Quesarito', 'Taco Bell Steak Spicy Cheesy Core Burrito', 'Taco Bell Triple Layer Nachos', 'Taco Bell Triple Melt Burrito', 'Taco Bell Triple Melt Nachos', 'Taco Bell Wild Naked Chicken Chalupa', 'Taco Bell XXL Grilled Stuft Burrito - Beef', 'Taco Bell XXL Grilled Stuft Burrito - Chicken', 'Taco Bell XXL Grilled Stuft Burrito - Steak']
    
    def load_and_process_image(self, img_name):
        full_path = img_name
        image = tf.io.read_file(full_path)
        image = tf.io.decode_jpeg(contents=image, channels=3)
        image = tf.cast(image, tf.float32)
        image = tf.image.resize(image, size=(224, 224))
        return tf.keras.applications.vgg16.preprocess_input(image)
    
    def predict(self, imagename):
        image = self.load_and_process_image(imagename)
        image = np.reshape(image, (1, 224, 224, 3))

        # Predicting Labels
        predictions = self.model.predict(image)

        top10 = []
        for label in sorted(zip(predictions[0], self.csvdata))[-10:]:
            top10.append(label[1])
        
        top10.reverse()
        return top10
